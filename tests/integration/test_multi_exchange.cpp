#include \"coinbase_dtc_core/exchanges/base/exchange_feed.hpp\"\n#include \"coinbase_dtc_core/exchanges/factory/exchange_factory.hpp\"\n#include \"coinbase_dtc_core/core/util/log.hpp\"\n#include <iostream>\n#include <thread>\n#include <chrono>\n#include <atomic>\n\nusing namespace coinbase_dtc_core;\n\nclass IntegrationCallbacks {\npublic:\n    std::atomic<int> total_trades{0};\n    std::atomic<int> total_level2{0};\n    std::atomic<int> coinbase_trades{0};\n    std::atomic<int> binance_trades{0};\n    \n    void on_trade(const exchanges::base::MarketTrade& trade) {\n        total_trades++;\n        if (trade.exchange == \"coinbase\") {\n            coinbase_trades++;\n        } else if (trade.exchange == \"binance\") {\n            binance_trades++;\n        }\n        \n        util::log(\"[INTEGRATION] Trade from \" + trade.exchange + \": \" + trade.symbol + \n                 \" @\" + std::to_string(trade.price));\n    }\n    \n    void on_level2(const exchanges::base::MarketLevel2& level2) {\n        total_level2++;\n        util::log(\"[INTEGRATION] Level2 from \" + level2.exchange + \": \" + level2.symbol);\n    }\n};\n\nint main() {\n    util::log(\"[TEST] Starting Multi-Exchange Integration tests...\");\n    \n    try {\n        // Test 1: Create multi-exchange feed\n        exchanges::base::MultiExchangeFeed multi_feed;\n        util::log(\"[TEST] ✅ Multi-exchange feed created\");\n        \n        // Test 2: Set up global callbacks\n        IntegrationCallbacks callbacks;\n        multi_feed.set_trade_callback([&callbacks](const exchanges::base::MarketTrade& trade) {\n            callbacks.on_trade(trade);\n        });\n        \n        multi_feed.set_level2_callback([&callbacks](const exchanges::base::MarketLevel2& level2) {\n            callbacks.on_level2(level2);\n        });\n        \n        // Test 3: Add exchanges\n        exchanges::base::ExchangeConfig coinbase_config;\n        coinbase_config.name = \"coinbase\";\n        \n        exchanges::base::ExchangeConfig binance_config;\n        binance_config.name = \"binance\";\n        \n        bool added_coinbase = multi_feed.add_exchange(coinbase_config);\n        bool added_binance = multi_feed.add_exchange(binance_config);\n        \n        if (added_coinbase && added_binance) {\n            util::log(\"[TEST] ✅ Both exchanges added successfully\");\n        }\n        \n        // Test 4: Check active exchanges\n        auto active = multi_feed.get_active_exchanges();\n        util::log(\"[TEST] Active exchanges: \" + std::to_string(active.size()));\n        for (const auto& exchange : active) {\n            util::log(\"  - \" + exchange + \" (connected)\");\n        }\n        \n        // Test 5: Subscribe to same symbol on multiple exchanges\n        bool sub_all = multi_feed.subscribe_symbol(\"BTC-USD\"); // All exchanges\n        if (sub_all) {\n            util::log(\"[TEST] ✅ Subscribed BTC-USD on all exchanges\");\n        }\n        \n        // Test 6: Subscribe to exchange-specific symbol\n        bool sub_coinbase = multi_feed.subscribe_symbol(\"ETH-USD\", \"coinbase\");\n        if (sub_coinbase) {\n            util::log(\"[TEST] ✅ Subscribed ETH-USD on Coinbase only\");\n        }\n        \n        // Test 7: Wait for aggregated data\n        util::log(\"[TEST] Collecting aggregated market data (10 seconds)...\");\n        std::this_thread::sleep_for(std::chrono::seconds(10));\n        \n        // Test 8: Display statistics\n        util::log(\"[TEST] === INTEGRATION STATISTICS ===\");\n        util::log(\"  Total trades: \" + std::to_string(callbacks.total_trades.load()));\n        util::log(\"  Total level2: \" + std::to_string(callbacks.total_level2.load()));\n        util::log(\"  Coinbase trades: \" + std::to_string(callbacks.coinbase_trades.load()));\n        util::log(\"  Binance trades: \" + std::to_string(callbacks.binance_trades.load()));\n        \n        // Test 9: Get subscription count\n        size_t total_subscriptions = multi_feed.get_total_subscriptions();\n        util::log(\"  Total subscriptions: \" + std::to_string(total_subscriptions));\n        \n        // Test 10: Display status\n        std::string status = multi_feed.get_status();\n        util::log(\"[TEST] === MULTI-EXCHANGE STATUS ===\");\n        util::log(status);\n        \n        // Test 11: Unsubscribe from specific exchange\n        bool unsub_coinbase = multi_feed.unsubscribe_symbol(\"ETH-USD\", \"coinbase\");\n        if (unsub_coinbase) {\n            util::log(\"[TEST] ✅ Unsubscribed ETH-USD from Coinbase\");\n        }\n        \n        // Test 12: Unsubscribe from all exchanges\n        bool unsub_all = multi_feed.unsubscribe_symbol(\"BTC-USD\");\n        if (unsub_all) {\n            util::log(\"[TEST] ✅ Unsubscribed BTC-USD from all exchanges\");\n        }\n        \n        // Test 13: Remove exchange\n        bool removed = multi_feed.remove_exchange(\"binance\");\n        if (removed) {\n            util::log(\"[TEST] ✅ Binance exchange removed\");\n        }\n        \n        util::log(\"[TEST] All Integration tests completed successfully! ✅\");\n        util::log(\"[TEST] \\n=== FINAL STATS ===\");\n        util::log(\"  Processed \" + std::to_string(callbacks.total_trades.load()) + \" trades total\");\n        util::log(\"  Processed \" + std::to_string(callbacks.total_level2.load()) + \" level2 updates total\");\n        util::log(\"  Multi-exchange aggregation working correctly ✅\");\n        \n        return 0;\n        \n    } catch (const std::exception& e) {\n        util::log(\"[ERROR] Integration test failed: \" + std::string(e.what()));\n        return 1;\n    }\n}"