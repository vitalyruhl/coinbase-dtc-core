# ğŸš€ Adding a New Exchange - Developer Guide\n\n## Overview\nThis guide shows how to add a new exchange (e.g., Kraken, FTX, OKX) by copying the Coinbase template.\n\n## ğŸ“ Folder Structure\n```\nexchanges/\nâ”œâ”€â”€ base/                    # Abstract base classes (DON'T MODIFY)\nâ”‚   â””â”€â”€ exchange_feed.hpp\nâ”œâ”€â”€ coinbase/               # Coinbase implementation (TEMPLATE)\nâ”‚   â””â”€â”€ coinbase_feed.hpp\nâ”œâ”€â”€ binance/               # Binance implementation (EXAMPLE)\nâ”‚   â””â”€â”€ binance_feed.hpp\nâ”œâ”€â”€ YOUR_EXCHANGE/         # Your new exchange\nâ”‚   â””â”€â”€ your_exchange_feed.hpp\nâ””â”€â”€ factory/\n    â””â”€â”€ exchange_factory.hpp # UPDATE THIS\n```\n\n## ğŸ”§ Step-by-Step Instructions\n\n### Step 1: Copy Template\n1. Copy entire `exchanges/coinbase/` folder\n2. Rename to `exchanges/kraken/` (or your exchange name)\n3. Rename files: `coinbase_feed.hpp` â†’ `kraken_feed.hpp`\n\n### Step 2: Update Namespace\n```cpp\n// OLD (Coinbase)\nnamespace coinbase_dtc_core {\nnamespace exchanges {\nnamespace coinbase {\n\n// NEW (Kraken)\nnamespace coinbase_dtc_core {\nnamespace exchanges {\nnamespace kraken {\n```\n\n### Step 3: Update Class Name\n```cpp\n// OLD\nclass CoinbaseFeed : public base::ExchangeFeedBase {\n\n// NEW\nclass KrakenFeed : public base::ExchangeFeedBase {\n```\n\n### Step 4: Implement Symbol Mapping\n```cpp\n// Example: Kraken uses different symbol format\nvoid KrakenFeed::initialize_symbol_mappings() {\n    std::vector<std::pair<std::string, std::string>> mappings = {\n        {\"BTC/USD\", \"XBTUSD\"},      // Normalized â†’ Kraken format\n        {\"ETH/USD\", \"ETHUSD\"},\n        {\"BTC/EUR\", \"XBTEUR\"},\n        // Add more symbols...\n    };\n    \n    for (const auto& [normalized, kraken] : mappings) {\n        normalized_to_kraken_[normalized] = kraken;\n        kraken_to_normalized_[kraken] = normalized;\n    }\n}\n```\n\n### Step 5: Update Exchange Configuration\n```cpp\n// In initialize_symbol_mappings() constructor\nKrakenFeed::KrakenFeed(const base::ExchangeConfig& config)\n    : base::ExchangeFeedBase(config) {\n    \n    // Update WebSocket URL for Kraken\n    config_.websocket_url = \"wss://ws.kraken.com\";\n    config_.api_url = \"https://api.kraken.com\";\n    \n    initialize_symbol_mappings();\n}\n```\n\n### Step 6: Implement WebSocket Protocol\n```cpp\n// Kraken-specific subscription message\nstd::string KrakenFeed::create_subscribe_message(const std::string& symbol) const {\n    // Kraken WebSocket format\n    return R\"({\n        \"event\": \"subscribe\",\n        \"pair\": [\"\" + symbol + \"\"],\n        \"subscription\": {\"name\": \"trade\"}\n    })\";\n}\n```\n\n### Step 7: Update Factory\nAdd to `exchanges/factory/exchange_factory.hpp`:\n```cpp\n#include \"../kraken/kraken_feed.hpp\"  // ADD THIS\n\nstd::unique_ptr<base::ExchangeFeedBase> ExchangeFactory::create_feed(const base::ExchangeConfig& config) {\n    if (config.name == \"coinbase\") {\n        return std::make_unique<coinbase::CoinbaseFeed>(config);\n    } else if (config.name == \"binance\") {\n        return std::make_unique<binance::BinanceFeed>(config);\n    } else if (config.name == \"kraken\") {          // ADD THIS\n        return std::make_unique<kraken::KrakenFeed>(config);\n    }\n    // ...\n}\n\nstd::vector<std::string> ExchangeFactory::get_supported_exchanges() {\n    return {\"coinbase\", \"binance\", \"kraken\"};  // ADD \"kraken\"\n}\n```\n\n### Step 8: Test Your Exchange\n```cpp\n// Add to server\nserver.add_exchange(\"kraken\");\n\n// Subscribe to symbol\nserver.subscribe_symbol(\"BTC/USD\", \"kraken\");\n```\n\n## ğŸ¯ Key Implementation Points\n\n### Symbol Mapping (CRITICAL)\n- **normalize_symbol()**: Convert exchange format â†’ standard format\n- **exchange_symbol()**: Convert standard format â†’ exchange format\n- **Example**: \"XBTUSD\" (Kraken) â†” \"BTC/USD\" (Standard)\n\n### WebSocket Protocol (EXCHANGE-SPECIFIC)\n- Implement connection logic for your exchange\n- Handle exchange-specific message formats\n- Parse JSON responses correctly\n\n### Error Handling\n- Use `notify_error()` for connection issues\n- Use `notify_connection()` for status changes\n- Use `notify_trade()` and `notify_level2()` for market data\n\n## âœ… Testing Checklist\n\n- [ ] Exchange connects successfully\n- [ ] Symbol mapping works both ways\n- [ ] Trade data is received and parsed\n- [ ] Level2/OrderBook data works\n- [ ] Multiple symbols can be subscribed\n- [ ] Unsubscribe works correctly\n- [ ] Error handling works\n- [ ] Memory leaks checked\n\n## ğŸ“ Notes\n\n- Keep the same interface as `ExchangeFeedBase`\n- Don't modify files in `base/` folder\n- All exchanges share the same callback system\n- Symbol normalization ensures compatibility with DTC clients\n- Use existing logging system with `notify_error()`\n\n## ğŸ”— Example Exchanges\n\n- **Coinbase**: Reference implementation\n- **Binance**: Shows different symbol format (BTCUSDT vs BTC-USD)\n- **Your Exchange**: Copy coinbase, adapt as needed\n\nEach exchange is completely independent - perfect for team development!"